"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([["3681"],{41087(e,t,a){a.d(t,{A:()=>m});var s=a(90290),l=a(3087),i=a(40574),r=a(9315),o=a(49839),u=a(74064),n=a(94712),c=a(7932),p=a(76302),d=a(24235),b=a(57507),v=a(43225);let m={__name:"index",props:{options:{type:Object,required:!0},height:{type:[String,Number],default:"100%"},theme:{type:String,default:"default"},notMerge:{type:Boolean,default:!1},lazyUpdate:{type:Boolean,default:!1}},setup(e,t){let{expose:a}=t;l.Y([u.a,n.a,c.a,p.a,d.a,b.a,r.a,o.a,v.a]);let m=(0,s.KR)(null),g=(0,s.EW)(()=>"number"==typeof e.height?`${e.height}px`:e.height),_=null,f=null,y=()=>{m.value&&(_=i.Ts(m.value,e.theme,{renderer:"canvas",useDirtyRect:!0}),R(),(f=new ResizeObserver(()=>{requestAnimationFrame(()=>{null==_||_.resize()})})).observe(m.value))},R=()=>{_&&e.options&&_.setOption(e.options,{notMerge:e.notMerge,lazyUpdate:e.lazyUpdate})};return(0,s.sV)(()=>{y()}),(0,s.hi)(()=>{null==f||f.disconnect(),_&&(_.dispose(),_=null)}),(0,s.wB)(()=>e.options,()=>{R()},{deep:!0}),(0,s.wB)(()=>e.theme,()=>{_&&(_.dispose(),y())}),a({getChartInstance:()=>_,resize:()=>null==_?void 0:_.resize()}),(e,t)=>((0,s.uX)(),(0,s.CE)("div",{ref_key:"chartRef",ref:m,style:(0,s.Tr)({width:"100%",height:(0,s.R1)(g)})},null,4))}}},91756(e,t,a){a.d(t,{A:()=>u});var s=a(27546),l=a(29207),i=a(90290);let r={class:"flex gap-10px"},o={class:"flex-center w-40px"},u=(0,i.pM)({__name:"index",props:{data:{type:Array,default:()=>[]},rowKey:{type:Function,required:!0},options:{type:Array,default:()=>[]},checkedRowKeys:{type:Array,default:()=>[]}},emits:["updateCheckedRowKeys","select"],setup(e,t){let{emit:a}=t,u=(0,i.EW)({get:()=>e.checkedRowKeys.length>0&&e.checkedRowKeys.length===e.data.length,set(t){a("updateCheckedRowKeys",t?e.data.map(t=>e.rowKey(t)):[])}}),n=(0,i.EW)(()=>0===e.data.length),c=(0,i.EW)(()=>e.checkedRowKeys.length>0&&e.checkedRowKeys.length<e.data.length),p=(0,i.EW)(()=>0===e.checkedRowKeys.length);return(t,d)=>{let b=l.A,v=s.Ay;return(0,i.uX)(),(0,i.CE)("div",r,[(0,i.Lk)("div",o,[(0,i.bF)(b,{checked:(0,i.R1)(u),"onUpdate:checked":d[0]||(d[0]=e=>(0,i.i9)(u)?u.value=e:null),disabled:(0,i.R1)(n),indeterminate:(0,i.R1)(c)},null,8,["checked","disabled","indeterminate"])]),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.options,t=>((0,i.uX)(),(0,i.Wv)(v,{key:t.value,disabled:(0,i.R1)(p)||t.disabled,onClick:s=>{a("select",t.value,e.checkedRowKeys)}},{default:(0,i.k6)(()=>[(0,i.eW)((0,i.v_)(t.label),1)]),_:2},1032,["disabled","onClick"]))),128))])}}})},83910(e,t,a){a.r(t),a.d(t,{default:()=>em});var s=a(63919),l=a(23618),i=a(77625),r=a(28391),o=a(90216),u=a(91756),n=a(95403),c=a(90290),p=a(97786),d=a(23254),b=a(85684),v=a(27546),m=a(12532),g=a(60045),_=a(80111),f=a(85020);let{t:y}=a(46831).Ru.global,R=e=>f.K.get("/contact/list_ndp",{params:e}),h=e=>f.K.post("/contact/delete_ndp",e,{fetchOptions:{loading:y("contacts.subscribers.loading.deleteSubscriber"),successMessage:!0}});var k=a(3733),x=a(3401);let F=(0,c.pM)({__name:"GroupSelect",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){let{t}=(0,x.s9)(),a=(0,c.fn)(e,"value"),s=(0,c.KR)([{label:t("common.all.text"),value:0}]);return(async()=>{let e=await (0,k.d2)();(0,m.Gv)(e)&&(s.value=e.list.map(e=>({label:e.name,value:e.id})),s.value.unshift({label:t("common.all.text"),value:0}))})(),(e,t)=>{let l=n.A;return(0,c.uX)(),(0,c.Wv)(l,{value:a.value,"onUpdate:value":t[0]||(t[0]=e=>a.value=e),options:(0,c.R1)(s)},null,8,["value","options"])}}});var w=a(63114),A=a(75220);let S=(0,c.pM)({__name:"TagSelect",props:(0,c.zz)({groupId:{type:Number,default:0}},{value:{},valueModifiers:{}}),emits:["update:value"],setup(e){let{t}=(0,x.s9)(),a=(0,c.fn)(e,"value"),s=(0,c.KR)([]),l=(0,c.EW)(()=>s.value.filter(t=>0===e.groupId||e.groupId===t.group_id).map(e=>({label:e.name,value:e.id})));(async()=>{let e=await (0,w.cl)({});(0,m.Gv)(e)&&(s.value=e.list)})();let i=(0,A.rd)(),r=()=>{i.push({path:"/contacts/tags",state:{group_id:e.groupId}})};return(e,s)=>{let i=v.Ay,o=n.A;return(0,c.uX)(),(0,c.Wv)(o,{value:a.value,"onUpdate:value":s[0]||(s[0]=e=>a.value=e),options:(0,c.R1)(l),multiple:!0,"max-tag-count":"responsive"},{action:(0,c.k6)(()=>[(0,c.bF)(i,{block:"",onClick:r},{default:(0,c.k6)(()=>[(0,c.eW)((0,c.v_)((0,c.R1)(t)("contacts.subscribers.tagSelect.manageTags")),1)]),_:1})]),_:1},8,["value","options"])}}}),W={class:"w-80px"},K={class:"w-120px"},C=(0,c.pM)({__name:"ActiveSelect",props:{value:{default:-1},valueModifiers:{},time:{},timeModifiers:{}},emits:["update:value","update:time"],setup(e){let{t}=(0,x.s9)(),a=(0,c.fn)(e,"value"),s=(0,c.EW)(()=>[{label:t("contacts.subscribers.activeSelect.options.all"),value:-1},{label:t("contacts.subscribers.activeSelect.options.yes"),value:1},{label:t("contacts.subscribers.activeSelect.options.no"),value:0}]),l=(0,c.fn)(e,"time"),i=(0,c.EW)(()=>[{label:t("contacts.subscribers.activeSelect.timeOptions.past7Days"),value:7},{label:t("contacts.subscribers.activeSelect.timeOptions.pastMonth"),value:30},{label:t("contacts.subscribers.activeSelect.timeOptions.past90Days"),value:90},{label:t("contacts.subscribers.activeSelect.timeOptions.pastHalfYear"),value:180},{label:t("contacts.subscribers.activeSelect.timeOptions.pastYear"),value:365}]),r=e=>{-1===e?l.value=0:l.value=365};return(e,t)=>{let o=n.A;return(0,c.uX)(),(0,c.CE)(c.FK,null,[(0,c.Lk)("div",W,[(0,c.bF)(o,{value:a.value,"onUpdate:value":[t[0]||(t[0]=e=>a.value=e),r],options:(0,c.R1)(s)},null,8,["value","options"])]),(0,c.bo)((0,c.Lk)("div",K,[(0,c.bF)(o,{value:l.value,"onUpdate:value":t[1]||(t[1]=e=>l.value=e),options:(0,c.R1)(i)},null,8,["value","options"])],512),[[c.aG,-1!==a.value]])],64)}}});var E=a(76628),L=a(41087);let O={class:"text-center fw-bold text-16px text-default"},U={class:"w-96% h-160px mx-auto"},M=(0,c.pM)({__name:"SubscriberTrends",props:{params:{type:Object,default:()=>({page:1,page_size:10,group_id:0,keyword:"",active:-1,last_active_status:-1,time_interval:0,tags:[]})}},setup(e,t){let{expose:a}=t,s=(0,c.KR)(!1),l=(0,c.KR)([]),{t:i}=(0,x.s9)(),r=(0,c.EW)(()=>({tooltip:{trigger:"axis",order:"seriesDesc",axisPointer:{type:"shadow"}},grid:{top:"16%",left:"2%",right:"2%",bottom:"4%",containLabel:!0},xAxis:{data:l.value.map(e=>e.date),axisTick:{show:!1},axisLabel:{color:"#6b7280",fontSize:12}},yAxis:{type:"value",minInterval:1,axisLabel:{color:"#6b7280",fontSize:12}},series:[{name:i("contacts.subscribers.trends.subscriber"),type:"line",data:l.value.map(e=>e.count),itemStyle:{color:"#20a53a"},smooth:!0,showSymbol:!1,sampling:"average",areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,global:!1,colorStops:[{offset:0,color:"rgba(32, 164, 58, 0.4)"},{offset:.7,color:"rgba(32, 164, 58, 0)"}]}}}]})),o=async()=>{try{let t;s.value=!0;let a=await (t={group_id:e.params.group_id,active:e.params.active,last_active_status:e.params.last_active_status,time_interval:e.params.time_interval,tags:e.params.tags.join(",")},f.K.get("/contact/trend",{params:t}));(0,m.Gv)(a)&&("monthly"===a.time_granularity?l.value=(0,m.cy)(a.monthly_data)?a.monthly_data:[]:"daily"===a.time_granularity&&(l.value=(0,m.cy)(a.daily_data)?a.daily_data:[]))}finally{s.value=!1}};return(0,c.sV)(()=>{o()}),a({getData:o}),(e,t)=>{let a=L.A,l=E.A;return(0,c.uX)(),(0,c.Wv)(l,{class:"mb-16px",show:(0,c.R1)(s)},{default:(0,c.k6)(()=>[(0,c.Lk)("div",O,(0,c.v_)((0,c.R1)(i)("contacts.subscribers.trends.title")),1),(0,c.Lk)("div",U,[(0,c.bF)(a,{options:(0,c.R1)(r)},null,8,["options"])])]),_:1},8,["show"])}}});var $=a(13665),X=a(45449),T=a(60319),z=a(5887),G=a(99076),I=a(91664),D=a(10932),j=a(60801),B=a(66401),q=a(96833);let N=(0,c.pM)({__name:"GroupMultipleSelect",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){let t=(0,c.fn)(e,"value"),a=(0,c.KR)([]),s=(0,c.KR)(!1);return(async()=>{try{s.value=!0;let e=await (0,k.d2)();(0,m.Gv)(e)&&(a.value=e.list.map(e=>({label:e.name,value:e.id})))}finally{s.value=!1}})(),(e,l)=>{let i=n.A;return(0,c.uX)(),(0,c.Wv)(i,{value:t.value,"onUpdate:value":l[0]||(l[0]=e=>t.value=e),"max-tag-count":"responsive",multiple:!0,filterable:!0,loading:(0,c.R1)(s),options:(0,c.R1)(a)},null,8,["value","loading","options"])}}}),P={class:"pt-12px"},Q={class:"flex-1"},J={class:"mb-8px text-desc"},H={class:"w-260px"},Y={class:"flex-1"},V={class:"mt-8px"},Z={class:"mt-8px text-12px text-desc"},ee={class:"mt-8px text-12px text-desc"},et=`email,attributes
example1@example.com,"{""age"": ""13"", ""Gender"": ""XXX""}"
example2@example.com,"{""age"": ""45"", ""city"": ""XXX""}"
`,ea=(0,c.pM)({__name:"SubscriberImport",setup(e){let{t}=(0,x.s9)(),a=(0,c.rk)("formRef"),s=(0,c.KR)("paste"),l=(0,c.Kh)({group_ids:[],import_type:1,contacts:"",file_data:"",file_type:"",overwrite:0,default_active:1,status:1}),i={group_ids:{trigger:"change",validator:()=>0!==l.group_ids.length||Error(t("contacts.subscribers.import.validation.groupRequired"))},contacts:{validator:()=>!(2===l.import_type&&(0,B.A)(l.contacts))||Error(t("contacts.subscribers.import.validation.dataRequired"))}},r=(0,c.EW)(()=>[{label:t("contacts.subscribers.import.overwriteOptions.no"),value:0},{label:t("contacts.subscribers.import.overwriteOptions.yes"),value:1}]),o=(0,c.EW)(()=>[{label:t("contacts.subscribers.import.subscriptionOptions.subscribe"),value:1},{label:t("contacts.subscribers.import.subscriptionOptions.unsubscribe"),value:0}]),u=(0,c.EW)(()=>[{label:t("contacts.subscribers.import.statusOptions.confirmed"),value:1},{label:t("contacts.subscribers.import.statusOptions.unconfirmed"),value:0}]),p=e=>{let t=new FileReader;t.onload=t=>{var a;l.file_type=e.name.substring(e.name.lastIndexOf(".")+1),l.file_data=null==(a=t.target)?void 0:a.result},e.file&&t.readAsText(e.file)},d=async()=>{await (0,q.PE)({file_path:"./template/example_recipients.csv"})},b=async()=>{var e;if(await (null==(e=a.value)?void 0:e.validate()),"upload"===s.value&&(0,B.A)(l.file_data))return m.QB.error(t("contacts.subscribers.import.validation.fileRequired")),Promise.reject()},[_,R]=(0,g.h)({onChangeState:e=>{if(e){let e=R.getState();(null==e?void 0:e.group_id)?l.group_ids=[e.group_id]:l.group_ids=[]}else l.import_type=1,l.contacts="",l.file_data="",l.file_type="",l.group_ids=[],l.overwrite=0,l.default_active=1,l.status=1},onConfirm:async()=>{let e;await b(),await (e=(0,c.ux)(l),f.K.post("/contact/group/import",e,{fetchOptions:{loading:y("contacts.subscribers.loading.importSubscribers"),successMessage:!0}}));let t=R.getState();null==t||t.refresh()}});return(e,t)=>{let s=n.A,b=j.Ay,m=D.Ay,g=I.A,f=G.A,y=z.A,R=T.A,h=v.Ay,k=X.A,x=$.A;return(0,c.uX)(),(0,c.Wv)((0,c.R1)(_),{title:e.$t("contacts.subscribers.import.title"),width:"640"},{default:(0,c.k6)(()=>[(0,c.Lk)("div",P,[(0,c.bF)(x,{ref_key:"formRef",ref:a,model:(0,c.R1)(l),rules:i},{default:(0,c.k6)(()=>[(0,c.bF)(b,{label:e.$t("contacts.subscribers.import.overwriteLabel")},{default:(0,c.k6)(()=>[(0,c.Lk)("div",Q,[(0,c.Lk)("div",J,(0,c.v_)(e.$t("contacts.subscribers.import.overwriteDescription")),1),(0,c.Lk)("div",H,[(0,c.bF)(s,{value:(0,c.R1)(l).overwrite,"onUpdate:value":t[0]||(t[0]=e=>(0,c.R1)(l).overwrite=e),options:(0,c.R1)(r)},null,8,["value","options"])])])]),_:1},8,["label"]),(0,c.bF)(g,{cols:2,"x-gap":24},{default:(0,c.k6)(()=>[(0,c.bF)(m,{span:1,label:e.$t("contacts.subscribers.import.subscriptionStatus")},{default:(0,c.k6)(()=>[(0,c.bF)(s,{value:(0,c.R1)(l).default_active,"onUpdate:value":t[1]||(t[1]=e=>(0,c.R1)(l).default_active=e),options:(0,c.R1)(o)},null,8,["value","options"])]),_:1},8,["label"]),(0,c.bF)(m,{span:1,label:e.$t("contacts.subscribers.import.status")},{default:(0,c.k6)(()=>[(0,c.bF)(s,{value:(0,c.R1)(l).status,"onUpdate:value":t[2]||(t[2]=e=>(0,c.R1)(l).status=e),options:(0,c.R1)(u)},null,8,["value","options"])]),_:1},8,["label"])]),_:1}),(0,c.bF)(b,{label:e.$t("contacts.subscribers.import.group"),path:"group_id"},{default:(0,c.k6)(()=>[(0,c.bF)(N,{value:(0,c.R1)(l).group_ids,"onUpdate:value":t[3]||(t[3]=e=>(0,c.R1)(l).group_ids=e)},null,8,["value"])]),_:1},8,["label"]),(0,c.bF)(b,{label:e.$t("contacts.subscribers.import.data"),path:"contacts"},{default:(0,c.k6)(()=>[(0,c.Lk)("div",Y,[(0,c.bF)(y,{value:(0,c.R1)(l).import_type,"onUpdate:value":t[4]||(t[4]=e=>(0,c.R1)(l).import_type=e)},{default:(0,c.k6)(()=>[(0,c.bF)(f,{value:1},{default:(0,c.k6)(()=>[(0,c.eW)((0,c.v_)(e.$t("contacts.subscribers.import.uploadFile")),1)]),_:1}),(0,c.bF)(f,{value:2},{default:(0,c.k6)(()=>[(0,c.eW)((0,c.v_)(e.$t("contacts.subscribers.import.pasteData")),1)]),_:1})]),_:1},8,["value"]),(0,c.Lk)("div",V,[1===(0,c.R1)(l).import_type?((0,c.uX)(),(0,c.CE)(c.FK,{key:0},[(0,c.bF)(R,{"is-upload":!1,accept:["csv"],onChange:p}),(0,c.Lk)("div",Z,[(0,c.eW)((0,c.v_)(e.$t("contacts.subscribers.import.fileTypeHint"))+" ",1),(0,c.bF)(h,{text:"",type:"primary",onClick:d},{default:(0,c.k6)(()=>[(0,c.eW)((0,c.v_)(e.$t("common.actions.download")),1)]),_:1})])],64)):(0,c.Q3)("",!0),2===(0,c.R1)(l).import_type?((0,c.uX)(),(0,c.CE)(c.FK,{key:1},[(0,c.bF)(k,{value:(0,c.R1)(l).contacts,"onUpdate:value":t[5]||(t[5]=e=>(0,c.R1)(l).contacts=e),type:"textarea",rows:8},null,8,["value"]),(0,c.Lk)("div",ee,[(0,c.Lk)("p",null,(0,c.v_)(e.$t("contacts.subscribers.import.pastePlaceholder.0")),1)])],64)):(0,c.Q3)("",!0)])])]),_:1},8,["label"]),(0,c.bF)(b,{label:e.$t("contacts.subscribers.import.exampleCsvLabel")},{default:(0,c.k6)(()=>[(0,c.Lk)("pre",{class:"csv-example"},(0,c.v_)(et))]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["title"])}}});var es=a(64901);let el=(0,es.default)(ea,[["__scopeId","data-v-0e3de64c"]]),ei={class:"pt-12px"},er=(0,c.pM)({__name:"SubscriberEdit",setup(e){let{t}=(0,x.s9)(),a=(0,c.rk)("formRef"),s=(0,c.Kh)({id:0,email:"",active:1,status:1,attribs:"",group_ids:[]}),l={group_ids:{trigger:"change",validator:()=>0!==s.group_ids.length||Error(t("contacts.subscribers.edit.validation.groupRequired"))}},i=(0,c.EW)(()=>[{label:t("contacts.subscribers.edit.statusOptions.subscribe"),value:1},{label:t("contacts.subscribers.edit.statusOptions.unsubscribe"),value:0}]),r=(0,c.EW)(()=>[{label:t("contacts.subscribers.import.statusOptions.confirmed"),value:1},{label:t("contacts.subscribers.import.statusOptions.unconfirmed"),value:0}]),[o,u]=(0,g.h)({onChangeState:e=>{if(e){let{row:e}=u.getState();e&&(s.id=e.id,s.email=e.email,s.active=e.active,s.status=e.status,s.group_ids=[e.group_id],s.attribs=e.attribs?JSON.stringify(e.attribs,null,2):"")}else s.id=0,s.email="",s.active=1,s.status=1,s.group_ids=[],s.attribs=""},onConfirm:async()=>{var e;let t;await (null==(e=a.value)?void 0:e.validate());let l={};try{l=s.attribs?JSON.parse(s.attribs):{}}catch(e){return m.QB.error(`${e}`,{close:!0}),!1}await (t={id:s.id,active:s.active,status:s.status,attribs:JSON.stringify(l)},f.K.post("/contact/edit_ndp",t,{fetchOptions:{loading:y("contacts.subscribers.loading.updateSubscriberGroup"),successMessage:!0}})),u.getState().refresh()}});return(e,t)=>{let u=X.A,p=D.Ay,d=n.A,b=I.A,v=j.Ay,m=$.A;return(0,c.uX)(),(0,c.Wv)((0,c.R1)(o),{title:e.$t("contacts.subscribers.edit.title"),width:"600"},{default:(0,c.k6)(()=>[(0,c.Lk)("div",ei,[(0,c.bF)(m,{ref_key:"formRef",ref:a,model:(0,c.R1)(s),rules:l},{default:(0,c.k6)(()=>[(0,c.bF)(b,{cols:12,"x-gap":24},{default:(0,c.k6)(()=>[(0,c.bF)(p,{span:8,label:e.$t("contacts.subscribers.edit.email")},{default:(0,c.k6)(()=>[(0,c.bF)(u,{value:(0,c.R1)(s).email,"onUpdate:value":t[0]||(t[0]=e=>(0,c.R1)(s).email=e),disabled:!0},null,8,["value"])]),_:1},8,["label"]),(0,c.bF)(p,{span:4,label:e.$t("contacts.subscribers.import.subscriptionStatus")},{default:(0,c.k6)(()=>[(0,c.bF)(d,{value:(0,c.R1)(s).active,"onUpdate:value":t[1]||(t[1]=e=>(0,c.R1)(s).active=e),options:(0,c.R1)(i)},null,8,["value","options"])]),_:1},8,["label"])]),_:1}),(0,c.bF)(b,{cols:12,"x-gap":24},{default:(0,c.k6)(()=>[(0,c.bF)(p,{span:8,label:e.$t("contacts.subscribers.edit.group"),path:"group_ids"},{default:(0,c.k6)(()=>[(0,c.bF)(N,{value:(0,c.R1)(s).group_ids,"onUpdate:value":t[2]||(t[2]=e=>(0,c.R1)(s).group_ids=e),disabled:!0},null,8,["value"])]),_:1},8,["label"]),(0,c.bF)(p,{span:4,label:e.$t("contacts.subscribers.import.status")},{default:(0,c.k6)(()=>[(0,c.bF)(d,{value:(0,c.R1)(s).status,"onUpdate:value":t[3]||(t[3]=e=>(0,c.R1)(s).status=e),options:(0,c.R1)(r)},null,8,["value","options"])]),_:1},8,["label"])]),_:1}),(0,c.bF)(v,{label:e.$t("contacts.subscribers.edit.attributes")},{default:(0,c.k6)(()=>[(0,c.bF)(u,{value:(0,c.R1)(s).attribs,"onUpdate:value":t[4]||(t[4]=e=>(0,c.R1)(s).attribs=e),type:"textarea",rows:6},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["title"])}}});var eo=a(34020);let eu={class:"flex-1 mr-12px"},en=(0,c.pM)({__name:"BatchSetTag",setup(e){let{t}=(0,x.s9)(),a=(0,c.Kh)({tag_ids:[],action:1}),s=(0,c.KR)([]),l=(0,c.EW)(()=>[{label:t("contacts.subscribers.batchSetTag.actions.add"),value:1},{label:t("contacts.subscribers.batchSetTag.actions.remove"),value:2}]),i=(0,c.KR)(!1),r=async()=>{try{i.value=!0;let e=await (0,w.cl)({});if((0,m.Gv)(e)){let{groupId:t}=b.getState();s.value=e.list.filter(e=>e.group_id===t).map(e=>({label:e.name,value:e.id}))}}finally{i.value=!1}},[o,u]=(0,g.h)({component:eo.A,state:{refresh:r}}),p=()=>{let{groupId:e}=b.getState();u.setState({row:null,isEdit:!1,groupId:e}),u.open()},[d,b]=(0,g.h)({onChangeState:e=>{e?r():(a.tag_ids=[],a.action=1,s.value=[])},onConfirm:async()=>{let e,{ids:t,refresh:s}=b.getState();await (e={ids:t,tag_ids:a.tag_ids,action:a.action},f.K.post("/contact/batch_tags_opt",e,{fetchOptions:{loading:y("contacts.subscribers.loading.batchSetTag"),successMessage:!0}})),s()}});return(e,r)=>{let u=n.A,b=v.Ay,m=j.Ay,g=$.A;return(0,c.uX)(),(0,c.Wv)((0,c.R1)(d),{title:(0,c.R1)(t)("contacts.subscribers.batchSetTag.title"),width:500},{default:(0,c.k6)(()=>[(0,c.bF)(g,{class:"pt-8px"},{default:(0,c.k6)(()=>[(0,c.bF)(m,{label:(0,c.R1)(t)("contacts.subscribers.batchSetTag.labels.tag")},{default:(0,c.k6)(()=>[(0,c.Lk)("div",eu,[(0,c.bF)(u,{value:(0,c.R1)(a).tag_ids,"onUpdate:value":r[0]||(r[0]=e=>(0,c.R1)(a).tag_ids=e),options:(0,c.R1)(s),multiple:!0,loading:(0,c.R1)(i),"max-tag-count":"responsive"},null,8,["value","options","loading"])]),(0,c.bF)(b,{type:"primary",text:"",onClick:p},{default:(0,c.k6)(()=>[(0,c.eW)((0,c.v_)(e.$t("common.actions.create")),1)]),_:1})]),_:1},8,["label"]),(0,c.bF)(m,{label:(0,c.R1)(t)("contacts.subscribers.batchSetTag.labels.action")},{default:(0,c.k6)(()=>[(0,c.bF)(u,{value:(0,c.R1)(a).action,"onUpdate:value":r[1]||(r[1]=e=>(0,c.R1)(a).action=e),options:(0,c.R1)(l)},null,8,["value","options"])]),_:1},8,["label"]),(0,c.bF)((0,c.R1)(o))]),_:1})]),_:1},8,["title"])}}}),ec={class:"w-140px"},ep={class:"w-140px"},ed={class:"w-200px"};function eb(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!(0,c.vv)(e)}let ev=(0,c.pM)({__name:"index",setup(e){let{t}=(0,x.s9)(),a=(0,p.ZDG)(),f=(0,A.rd)(),y=(0,c.rk)("trendRef"),k=(0,c.EW)(()=>[{label:t("common.all.text"),value:-1},{label:t("contacts.subscribers.status.subscribed"),value:1},{label:t("contacts.subscribers.status.unsubscribed"),value:0}]),{tableParams:w,tableProps:W,batchProps:K,pageProps:E,fetchTable:L,resetTable:O}=(0,_.u)({params:{page:1,page_size:10,group_id:a.value.state.group_id||0,keyword:"",active:-1,last_active_status:-1,time_interval:0,tags:a.value.state.tag_id?[a.value.state.tag_id]:[]},useParams:e=>({...e,tags:e.tags.join(",")}),fetchFn:R}),U=(0,c.EW)(()=>[{type:"selection",width:40},{key:"email",title:t("contacts.subscribers.columns.email"),minWidth:120,ellipsis:{tooltip:!0}},{key:"status",title:t("contacts.subscribers.labels.status").replace("ï¼š",""),minWidth:100,render:e=>{let a;if(0===e.active){let e;return(0,c.bF)(d.Ay,{size:"small",type:"error",bordered:!1},eb(e=t("contacts.subscribers.status.unsubscribed"))?e:{default:()=>[e]})}if(1===e.active&&0===e.status){let e;return(0,c.bF)(d.Ay,{size:"small",type:"default",bordered:!1},eb(e=t("contacts.subscribers.status.unconfirmed"))?e:{default:()=>[e]})}return(0,c.bF)(d.Ay,{size:"small",type:"success",bordered:!1},eb(a=t("contacts.subscribers.status.subscribed"))?a:{default:()=>[a]})}},{key:"last_active_at",title:t("contacts.subscribers.columns.lastActiveAt"),minWidth:100,render:e=>e.last_active_at?(0,p.uN2)(new Date(1e3*e.last_active_at)).value:"--"},{key:"groups",title:t("contacts.subscribers.joinGroup"),minWidth:100,render:e=>e.group_name||""},{key:"tags",title:t("contacts.subscribers.tags"),minWidth:100,render:e=>{let t;return e.tags&&0!==e.tags.length?(0,c.bF)(b.A,{inline:!0},eb(t=e.tags.map(e=>(0,c.bF)(d.Ay,{key:e.id,size:"small",bordered:!1},{default:()=>[e.name]})))?t:{default:()=>[t]}):"--"}},{title:t("common.columns.actions"),key:"actions",align:"right",width:180,render:e=>{let a,s;return(0,c.bF)(b.A,{inline:!0},{default:()=>[(0,c.bF)(v.Ay,{type:"primary",text:!0,onClick:()=>{B(e)}},eb(a=t("common.actions.edit"))?a:{default:()=>[a]}),(0,c.bF)(v.Ay,{type:"error",text:!0,onClick:()=>{q(e)}},eb(s=t("common.actions.delete"))?s:{default:()=>[s]})]})}}]),$=()=>{var e;O(),null==(e=y.value)||e.getData()},X=()=>{w.value.tags=[],$()},[T,z]=(0,g.h)({component:el,state:{refresh:L}}),G=()=>{z.setState({group_id:w.value.group_id}),z.open()},I=()=>{w.value.group_id?f.push(`/contacts/settings/${w.value.group_id}`):m.QB.warning(t("contacts.subscribers.selectGroupHint"))},[D,j]=(0,g.h)({component:er,state:{refresh:L}}),B=e=>{j.setState({row:e}),j.open()},q=e=>{(0,m.lJ)({title:t("contacts.subscribers.delete.title"),content:t("contacts.subscribers.delete.confirm",{email:e.email}),confirmText:t("common.actions.delete"),confirmType:"error",onConfirm:async()=>{await h({ids:[e.id]}),L()}})},N=(0,c.EW)(()=>[{label:t("common.actions.delete"),value:"delete"},{label:t("contacts.subscribers.actions.setTag"),value:"tag",disabled:0===w.value.group_id}]),P=(e,t)=>{switch(e){case"delete":Q(t);break;case"tag":Y(t)}},Q=e=>{(0,m.lJ)({title:t("contacts.subscribers.batchDelete.title"),content:t("contacts.subscribers.batchDelete.confirm"),confirmText:t("common.actions.delete"),confirmType:"error",onConfirm:async()=>{await h({ids:e}),L()}})},[J,H]=(0,g.h)({component:en,state:{refresh:L}}),Y=e=>{H.setState({ids:e,groupId:w.value.group_id}),H.open()};return(e,a)=>{let p=n.A,d=u.A,b=o.A,m=r.A,g=i.A,_=l.A,f=s.A;return(0,c.uX)(),(0,c.CE)("div",null,[(0,c.bF)(M,{ref_key:"trendRef",ref:y,params:(0,c.R1)(w)},null,8,["params"]),(0,c.bF)(f,null,{toolsLeft:(0,c.k6)(()=>[(0,c.Lk)("span",null,(0,c.v_)(e.$t("contacts.subscribers.select.prefix")),1),(0,c.Lk)("div",ec,[(0,c.bF)(F,{value:(0,c.R1)(w).group_id,"onUpdate:value":[a[0]||(a[0]=e=>(0,c.R1)(w).group_id=e),X]},null,8,["value"])]),(0,c.Lk)("span",null,(0,c.v_)((0,c.R1)(t)("contacts.subscribers.labels.status")),1),(0,c.Lk)("div",ep,[(0,c.bF)(p,{value:(0,c.R1)(w).active,"onUpdate:value":[a[1]||(a[1]=e=>(0,c.R1)(w).active=e),a[2]||(a[2]=()=>$())],options:(0,c.R1)(k)},null,8,["value","options"])]),(0,c.Lk)("span",null,(0,c.v_)((0,c.R1)(t)("contacts.subscribers.labels.tags")),1),(0,c.Lk)("div",ed,[(0,c.bF)(S,{value:(0,c.R1)(w).tags,"onUpdate:value":[a[3]||(a[3]=e=>(0,c.R1)(w).tags=e),a[4]||(a[4]=()=>$())],disabled:0===(0,c.R1)(w).group_id,"group-id":(0,c.R1)(w).group_id},null,8,["value","disabled","group-id"])]),(0,c.Lk)("span",null,(0,c.v_)((0,c.R1)(t)("contacts.subscribers.labels.active")),1),(0,c.bF)(C,{value:(0,c.R1)(w).last_active_status,"onUpdate:value":[a[5]||(a[5]=e=>(0,c.R1)(w).last_active_status=e),a[7]||(a[7]=()=>$())],time:(0,c.R1)(w).time_interval,"onUpdate:time":[a[6]||(a[6]=e=>(0,c.R1)(w).time_interval=e),a[8]||(a[8]=()=>$())]},null,8,["value","time"])]),pageLeft:(0,c.k6)(()=>[(0,c.bF)(d,(0,c.v6)((0,c.R1)(K),{options:(0,c.R1)(N),onSelect:P}),null,16,["options"])]),toolsRight:(0,c.k6)(()=>[(0,c.bF)(b,{value:(0,c.R1)(w).keyword,"onUpdate:value":a[9]||(a[9]=e=>(0,c.R1)(w).keyword=e),width:240,placeholder:(0,c.R1)(t)("contacts.subscribers.search.emailPlaceholder"),onSearch:(0,c.R1)(O)},null,8,["value","placeholder","onSearch"]),(0,c.bF)((0,c.R1)(v.Ay),{type:"primary",onClick:G},{default:(0,c.k6)(()=>[(0,c.eW)((0,c.v_)((0,c.R1)(t)("common.actions.import")),1)]),_:1}),(0,c.R1)(w).group_id?((0,c.uX)(),(0,c.Wv)((0,c.R1)(v.Ay),{key:0,onClick:I},{default:(0,c.k6)(()=>[(0,c.eW)((0,c.v_)((0,c.R1)(t)("common.actions.settings")),1)]),_:1})):(0,c.Q3)("",!0)]),table:(0,c.k6)(()=>[(0,c.bF)(g,(0,c.v6)((0,c.R1)(W),{columns:(0,c.R1)(U)}),{empty:(0,c.k6)(()=>[(0,c.bF)(m)]),_:1},16,["columns"])]),pageRight:(0,c.k6)(()=>[(0,c.bF)(_,(0,c.v6)((0,c.R1)(E),{onRefresh:(0,c.R1)(L)}),null,16,["onRefresh"])]),modal:(0,c.k6)(()=>[(0,c.bF)((0,c.R1)(T)),(0,c.bF)((0,c.R1)(D)),(0,c.bF)((0,c.R1)(J))]),_:1})])}}}),em=(0,es.default)(ev,[["__scopeId","data-v-48d4e538"]])}}]);